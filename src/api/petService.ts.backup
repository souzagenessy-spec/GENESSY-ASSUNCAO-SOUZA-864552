import api from './index';

// Configuração
const USE_MOCK = true; // ← Mude para false quando tiver credenciais

// Tipos
export interface Pet {
  id: number;
  nome: string;
  especie: string;
  idade: number;
  raca?: string;
  fotoUrl?: string;
  tutorId?: number;
  createdAt: string;
  updatedAt: string;
}

export interface PaginatedResponse<T> {
  data: T[];
  total: number;
  page: number;
  limit: number;
  totalPages: number;
}

// ========== DADOS MOCK ==========
const mockPets: Pet[] = [
  {
    id: 1,
    nome: "Rex",
    especie: "Cachorro",
    idade: 3,
    raca: "Labrador",
    fotoUrl: "https://cdn.pixabay.com/photo/2018/05/07/10/49/dog-3380649_640.jpg",
    createdAt: "2024-01-01T10:00:00Z",
    updatedAt: "2024-01-01T10:00:00Z"
  },
  {
    id: 2,
    nome: "Mimi",
    especie: "Gato",
    idade: 2,
    raca: "Siamês",
    fotoUrl: "https://cdn.pixabay.com/photo/2017/02/20/18/03/cat-2083492_640.jpg",
    createdAt: "2024-01-02T11:00:00Z",
    updatedAt: "2024-01-02T11:00:00Z"
  },
  {
    id: 3,
    nome: "Thor",
    especie: "Cachorro",
    idade: 4,
    raca: "Husky Siberiano",
    fotoUrl: "https://cdn.pixabay.com/photo/2018/05/07/10/48/husky-3380548_640.jpg",
    createdAt: "2024-01-03T12:00:00Z",
    updatedAt: "2024-01-03T12:00:00Z"
  },
  {
    id: 4,
    nome: "Luna",
    especie: "Gato",
    idade: 1,
    raca: "Persa",
    fotoUrl: "https://cdn.pixabay.com/photo/2015/11/16/14/43/cat-1045782_640.jpg",
    createdAt: "2024-01-04T13:00:00Z",
    updatedAt: "2024-01-04T13:00:00Z"
  }
];

// ========== FUNÇÕES MOCK ==========
const mockGetPets = async (
  page: number = 1, 
  limit: number = 10, 
  nome?: string
): Promise<PaginatedResponse<Pet>> => {
  console.log(\📦 MOCK: getPets(page=\, limit=\, nome="")\);
  
  // Filtro por nome
  let filtered = mockPets;
  if (nome) {
    filtered = mockPets.filter(p => 
      p.nome.toLowerCase().includes(nome.toLowerCase())
    );
  }
  
  // Paginação simulada
  const startIndex = (page - 1) * limit;
  const endIndex = startIndex + limit;
  const paginated = filtered.slice(startIndex, endIndex);
  
  return {
    data: paginated,
    total: filtered.length,
    page,
    limit,
    totalPages: Math.ceil(filtered.length / limit)
  };
};

const mockCreatePet = async (
  petData: Omit<Pet, 'id' | 'createdAt' | 'updatedAt'>
): Promise<Pet> => {
  console.log('📦 MOCK: createPet', petData);
  const newPet: Pet = {
    ...petData,
    id: Date.now(),
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString()
  };
  mockPets.push(newPet);
  return newPet;
};

const mockUpdatePet = async (
  id: number, 
  petData: Partial<Pet>
): Promise<Pet> => {
  console.log(\📦 MOCK: updatePet id=\\, petData);
  const index = mockPets.findIndex(p => p.id === id);
  if (index !== -1) {
    mockPets[index] = {
      ...mockPets[index],
      ...petData,
      updatedAt: new Date().toISOString()
    };
    return mockPets[index];
  }
  throw new Error(\Pet com id \ não encontrado\);
};

const mockDeletePet = async (id: number): Promise<void> => {
  console.log(\📦 MOCK: deletePet id=\\);
  const index = mockPets.findIndex(p => p.id === id);
  if (index !== -1) {
    mockPets.splice(index, 1);
  }
};

// ========== FUNÇÕES REAIS (para quando tiver credenciais) ==========
const realGetPets = async (
  page: number = 1, 
  limit: number = 10, 
  nome?: string
): Promise<PaginatedResponse<Pet>> => {
  const response = await api.get('/v1/pets', {
    params: { page, limit, nome },
  });
  return response.data;
};

const realCreatePet = async (
  petData: Omit<Pet, 'id' | 'createdAt' | 'updatedAt'>
): Promise<Pet> => {
  const response = await api.post('/v1/pets', petData);
  return response.data;
};

const realUpdatePet = async (
  id: number, 
  petData: Partial<Pet>
): Promise<Pet> => {
  const response = await api.put(\/v1/pets/\\, petData);
  return response.data;
};

const realDeletePet = async (id: number): Promise<void> => {
  await api.delete(\/v1/pets/\\);
};

// ========== EXPORTS ==========
export const getPets = USE_MOCK ? mockGetPets : realGetPets;
export const createPet = USE_MOCK ? mockCreatePet : realCreatePet;
export const updatePet = USE_MOCK ? mockUpdatePet : realUpdatePet;
export const deletePet = USE_MOCK ? mockDeletePet : realDeletePet;

